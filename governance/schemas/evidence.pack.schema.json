{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "canonical://house-of-consequences/schema/evidence-pack/v1.0",
  "title": "Evidence Pack Schema v1.0",
  "description": "Locked schema for validated evidence packages supporting Canonical Casebook cases in House of Consequences Governance.",
  "type": "object",
  "additionalProperties": false,

  "required": [
    "metadata",
    "scope",
    "methods",
    "findings",
    "attribution",
    "pdca_support",
    "governance_assessment"
  ],

  "properties": {
    "metadata": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "case_id",
        "domain",
        "version",
        "created_at",
        "authors",
        "data_sources"
      ],
      "properties": {
        "case_id": {
          "type": "string",
          "description": "Canonical Casebook case identifier this evidence supports."
        },
        "domain": {
          "type": "string",
          "description": "Sector or domain of the case (e.g. healthcare, finance, justice)."
        },
        "version": {
          "type": "string",
          "pattern": "^1\\.0\\.0$",
          "description": "Locked schema version."
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "authors": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string" }
        },
        "data_sources": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["provider", "dataset", "year"],
            "properties": {
              "provider": { "type": "string" },
              "dataset": { "type": "string" },
              "year": { "type": "integer" }
            }
          }
        }
      }
    },

    "scope": {
      "type": "object",
      "additionalProperties": false,
      "required": ["population", "timeframe"],
      "properties": {
        "population": { "type": "string" },
        "timeframe": {
          "type": "object",
          "additionalProperties": false,
          "required": ["start_year", "end_year"],
          "properties": {
            "start_year": { "type": "integer" },
            "end_year": { "type": "integer" }
          }
        },
        "exclusions": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "methods": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["method_type", "description"],
        "properties": {
          "method_type": {
            "type": "string",
            "enum": [
              "cohort_comparison",
              "regression_model",
              "excess_mortality",
              "cost_attribution"
            ]
          },
          "description": { "type": "string" },
          "controls": {
            "type": "array",
            "items": { "type": "string" }
          },
          "limitations": { "type": "string" }
        }
      }
    },

    "findings": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["metric", "baseline", "exposed"],
        "properties": {
          "metric": { "type": "string" },
          "baseline": { "type": "number" },
          "exposed": { "type": "number" },
          "unit": { "type": "string" },
          "confidence_interval": { "type": "string" }
        }
      }
    },

    "attribution": {
      "type": "object",
      "additionalProperties": false,
      "required": ["risk_difference"],
      "properties": {
        "risk_difference": { "type": "number" },
        "hazard_ratio": { "type": "number" },
        "attributable_fraction": { "type": "number" },
        "economic_impact": {
          "type": "object",
          "additionalProperties": false,
          "required": ["per_case_cost", "annual_total_cost", "currency"],
          "properties": {
            "per_case_cost": { "type": "number" },
            "annual_total_cost": { "type": "number" },
            "currency": { "type": "string" }
          }
        }
      }
    },

    "pdca_support": {
      "type": "object",
      "additionalProperties": false,
      "required": ["plan_signal", "do_signal", "check_signal"],
      "properties": {
        "plan_signal": { "type": "string" },
        "do_signal": { "type": "string" },
        "check_signal": { "type": "string" },
        "act_leverage_points": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "governance_assessment": {
      "type": "object",
      "additionalProperties": false,
      "required": ["normalized_error_indicator", "structural_risk_score"],
      "properties": {
        "normalized_error_indicator": { "type": "boolean" },
        "structural_risk_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "notes": { "type": "string" }
      }
    }
  }
}
